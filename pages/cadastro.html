<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script type="text/javascript" src="modoEscuro.js"></script>
    <title>Cadastro</title>
    <style>
        body.dark-mode {
            background-color: #2b2b2b;
            color: #ffffff;
        }

        a {
            text-decoration: none;
            color: black;
            cursor: pointer;
        }

        a.visited {
            text-decoration: none;
            color: white;

        }

        .item {
            font-family: Arial 'Arial Narrow';
            font-size: 1.8vh;
            font-weight: bold;
            color: rgb(239, 239, 239);
            background-color: #d689eb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 8vh;
            user-select: none;
        }

        .item:hover {
            background-color: rgb(164, 20, 253);
            transition: 0.15s ease-in-out;

        }

        .item.dark-mode {
            background-color: #1b1b1b;
        }

        .item:hover.dark-mode {
            background-color: #282828;
        }

        .ui {
            background-image: url('../cadastro1.png');
            background-position: right;
            background-size: contain;
            background-repeat: no-repeat;
            height: 92vh;
            align-items: center;
        }

        .nav-item {
            padding-left: 40.1%;
            padding-right: 40.1%;
            padding-top: 3.5vh;
            padding-bottom: 3.5vh;
            background-color: aqua;
        }

        .nav-item:hover {
            transition: 0.18s ease-in-out;
            background-color: rgb(162, 0, 255);
        }

        .btn-rose {
            height: 15vh;
            font-weight: bold;
            color: white;
            width: 32%;
            background-color: #d689eb;

        }

        .btn-rose:hover {
            color: white;
            background-color: #dca8e9;

        }

        .btn-rose:active {
            color: white !important;
            background-color: #dca8e9 !important;
        }

        .btn-rose.dark-mode {
            color: white;
            background-color: #1b1b1b;
        }


        .popup {
            display: none;
            left: 50%;
            transform: translateX(-50%);
            position: fixed;
            width: 50%;
            height: 50vh;
            background-color: white;
            box-shadow: 3px 3px 0px rgb(36, 36, 36);
            z-index: 1;
            border-radius: 5px;


        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 0;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .input {
            width: 60%;
            background-color: #dadada;
            color: rgb(0, 0, 0);
            border: none;
            border: 1px solid white;
            border-radius: 5px;
            padding: 10px 10px 10px 10px;
        }

        .texto {
            color: #d689eb;
            font-weight: bold;
        }

        .texto.dark-mode {
            color: #ffffff !important;
        }

        .texto1.dark-mode {
            color: #000000 !important;
        }
    </style>
</head>

<body>

    <nav class="container-fluid">
        <div class="row" style="height: 8vh;">
            <a href="../index.html" class="col-2 item dark-mode-element">
                <div>MENU</div>
            </a>

            <a class="col-2 item dark-mode-element" style="box-shadow: inset 0px 5px 0px 0px rgb(106, 106, 106);">
                <div>CADASTRO</div>
            </a>
            <a href="pagamento.html" class="col-2 item dark-mode-element">
                <div>PAGAMENTOS</div>
            </a>
            <a href="gerenciamento.html" class="col-2 item dark-mode-element">
                <div>GERENCIAMENTO</div>
            </a>
            <a href="configuracoes.html" class="col-2 item dark-mode-element">
                <div>CONFIGURAÇÕES</div>
            </a>
            <a class="col-2 item dark-mode-element" onclick="fecharWindo()">
                <div>SAIR</div>
            </a>


        </div>
    </nav>

    <div class="ui">

        <div class="container">

            <div class="row align-items-center" style="height: 92vh;">
                <div class="col-5">
                    <div class="display-6 texto dark-mode-element">FAÇA UM CADASTRO </div>
                    <div class="display-7 texto dark-mode-element" style="margin-top: 3vh; margin-bottom: 1vh;">Cadastre
                        suas
                        informações e veja o seu sistema ganhando forma. O cadastro de
                        produtos é crucial para o controle de estoque e a exibição de um catálogo completo. O cadastro
                        de funcionários é essencial para manter um registro detalhado da equipe que
                        contribui para o sucesso do seu negócio. Os cadastros de usuário são fundamentais para
                        personalizar a experiência de clientes e colaboradores.
                    </div>
                    <div style="width: 100%; height: 0.2vh; background-color: #d689eb; margin-bottom: 5vh;"></div>
                    <button type="button" class="btn btn-rose dark-mode-element" onclick="openPopup('popup1')">CADASTRE
                        UM
                        USUÁRIO</button>
                    <button type="button" class="btn btn-rose dark-mode-element"
                        style="margin-top: 5vh; margin-bottom: 5vh;" onclick="openPopup('popup2')">CADASTRE UM
                        PRODUTO</button>
                    <button type="button" class="btn btn-rose dark-mode-element" onclick="openPopup('popup3')">CADASTRE
                        UM
                        FUNCIONÁRIO</button>
                </div>

                <div class="popup" id="popup1">
                    <div class="container">
                        <div class="row">
                            <h2 class="mt-3 mb-5 text-center texto1 dark-mode-element">USUÁRIO</h2>
                            <div class="d-flex justify-content-center mb-4">
                                <button class="btn btn-dark" onclick="closePopup('popup1')"
                                    style="width: 50%; margin-right: 10px;">Cancelar</button>
                                <button class="btn btn-dark" id="cadUser" onclick="cadastrarUser()"
                                    style="width: 50%; margin-left: 10px;">Cadastrar</button>
                            </div>
                            <form class="">
                                <input type="text" class="input text-center mb-3" name="Email" placeholder="Email"
                                    id="emailUser" style="width: 100%;">
                                <input type="text" class="input text-center mb-3" name="nomeUser" placeholder="Nome"
                                    id="nomeUser" style="width: 100%;">

                                <input type="text" class="input text-center mb-3" name="Senha" placeholder="Senha"
                                    id="senha" style="width: 100%;">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="popup" id="popup2">
                    <div class="container">
                        <div class="row">
                            <h2 class="mt-3 mb-5 text-center texto1 dark-mode-element">PRODUTO</h2>
                            <div class="d-flex justify-content-center mb-4">
                                <button class="btn btn-dark" onclick="closePopup('popup2')"
                                    style="width: 50%; margin-right: 10px;">Cancelar</button>
                                <button class="btn btn-dark" onclick="cadastrarProd()"
                                    style="width: 50%; margin-left: 10px;">Cadastrar</button>
                            </div>
                            <form class="">
                                <input type="text" class="input text-center mb-3" name="nomePr"
                                    placeholder="Nome do Produto" id="nomePr">
                                <input type="number" class="input text-center mb-3" name="Preço" placeholder="Preço"
                                    id="preco" style="width: 39%;">
                                <input type="text" class="input text-center mb-3" name="descricao"
                                    placeholder="Descrição" id="descricao" style="width: 100%;">
                                <select class="input text-center mb-5" id="statusPr" name="status" style="width: 100%;">
                                    <option disabled selected>Status</option>
                                    <option value="1">Ativo</option>
                                    <option value="0">Inativo</option>
                                </select>

                            </form>
                        </div>
                    </div>
                </div>
                <div class="popup" id="popup3">
                    <div class="container">
                        <div class="row">
                            <h2 class="mt-3 mb-5 text-center texto1 dark-mode-element">FUNCIONÁRIO</h2>

                            <div class="d-flex justify-content-center mb-4">
                                <button class="btn btn-dark" onclick="closePopup('popup3')"
                                    style="width: 50%; margin-right: 10px;">Cancelar</button>
                                <button class="btn btn-dark" onclick="cadastrarFunc()"
                                    style="width: 50%; margin-left: 10px;">Cadastrar</button>
                            </div>

                            <form class="">
                                <input type="text" class="input text-center mb-3" name="email" placeholder="Email"
                                    id="email">
                                <input type="text" class="input text-center mb-3" name="username" placeholder="Nome"
                                    id="nomeFunc" style="width: 39%;">
                                <input type="text" class="input text-center mb-3" name="cargo" placeholder="Cargo"
                                    id="cargo">
                                <input type="number" class="input text-center mb-3" name="salario" placeholder="Salário"
                                    id="salario" style="width: 39%;">
                                <select class="input text-center mb-5" name="status" id="statusFunc"
                                    style="width: 100%;">
                                    <option disabled selected>Status</option>
                                    <option value="1">Ativo</option>
                                    <option value="0">Inativo</option>
                                </select>

                            </form>

                        </div>
                    </div>
                </div>
                <div class="overlay" id="overlay"></div>
            </div>

        </div>
    </div>


    <script>
        function limparCampos() {
            document.getElementById('emailUser').value = '';
            document.getElementById('nomeUser').value = '';
            document.getElementById('senha').value = '';
            document.getElementById('nomePr').value = '';
            document.getElementById('preco').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('email').value = '';
            document.getElementById('nomeFunc').value = '';
            document.getElementById('cargo').value = '';
            document.getElementById('salario').value = '';
            document.getElementById('statusFunc').value = "Status";
            document.getElementById('statusPr').value = "Status";
        }

        function openPopup(popupId) {
            const pop = document.getElementById(popupId).style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            limparCampos();
        }

        function closePopup(popupId) {
            document.getElementById(popupId).style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }


        async function verificaUser(nome) {
            const query = `
                query Query($nome: String!) {
                    usuarioByNome(Nome: $nome) {
                        Nome
                    }
                }
            `;

            const variables = {
                nome: nome,
            };

            try {
                const response = await axios.post('http://localhost:4000', { query, variables });
                const users = response.data.data.usuarioByNome;
                console.log('Response from server:', response.data);
                return users && users.some(user => user.Nome === nome);

            } catch (error) {
                console.error('Error from server:', error);
                return false;
            }
        }

        async function verificaFunc(nome) {
            const query = `
                query Query($nome: String!) {
                funcionariosByNome(nome: $nome) {
                    Nome
                }
            }
            `;

            const variables = {
                nome: nome,
            };

            try {
                const response = await axios.post('http://localhost:4000', { query, variables });
                const func = response.data.data.funcionariosByNome;
                console.log('Response from server:', response.data);
                return func && func.some(user => user.Nome === nome);

            } catch (error) {
                console.error('Error from server:', error);
                return false;
            }
        }

        async function cadastrarUser() {
            const email = document.getElementById('emailUser').value;
            const nome = document.getElementById('nomeUser').value;
            const senha = document.getElementById('senha').value;

            if (email.trim() === '' || nome.trim() === '' || senha.trim() === '') {
                Swal.fire({
                    title: 'Erro!',
                    text: 'Preencha Todos os Campos',
                    icon: 'error',
                    confirmButtonText: 'Ok',
                });
            } else if (email.trim().indexOf('@') === -1 || email.trim().indexOf('.') === -1) {
                Swal.fire({
                    title: 'Erro!',
                    text: 'Coloque um email válido',
                    icon: 'error',
                    confirmButtonText: 'Ok',
                });
            } else {
                try {
                    let userExists = await verificaUser(nome.trim());
                    console.log('User exists:', userExists);

                    if (userExists) {
                        Swal.fire({
                            title: 'Erro!',
                            text: 'O usuário Já Existe!',
                            icon: 'error',
                            confirmButtonText: 'Ok',
                        });
                    } else {
                        const query = `
                    mutation Mutation($data: DadosUsuario!) {
                        createUsuario(data: $data) {
                            Email
                            Nome
                            Senha
                            idUsuario
                        }
                    }
                `;

                        const variables = {
                            data: {
                                Email: email.trim(),
                                Senha: senha.trim(),
                                Nome: nome.trim(),
                            },
                        };

                        const response = await axios.post('http://localhost:4000', { query, variables });
                        console.log('User registered on server:', response.data);

                        Swal.fire({
                            title: 'Sucesso!',
                            text: 'Cadastro de Usuário Feito com Sucesso',
                            icon: 'success',
                            confirmButtonText: 'Ok',
                        });

                        closePopup('popup1');
                    }
                } catch (error) {
                    console.error('Error during user registration:', error);
                }
            }
        }



        async function cadastrarFunc() {
            const email = document.getElementById('email').value;
            const nome = document.getElementById('nomeFunc').value;
            const cargo = document.getElementById('cargo').value;
            const salario = document.getElementById('salario').value;
            const status = document.getElementById('statusFunc').value;
            if (email.trim() === '' || nome.trim() === '' || cargo.trim() === '' || salario.trim() === '' || status.trim() === 'Status') {
                Swal.fire({
                    title: 'Erro!',
                    text: 'Preencha Todos os Campos',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                });
            } else if (email.trim().indexOf('@') === -1 || email.trim().indexOf('.') === -1) {

                Swal.fire({
                    title: 'Erro!',
                    text: 'Coloque um email válido',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                });

            } else {
                try {
                    let userExists = await verificaUser(nome.trim());
                    console.log('User exists:', userExists);

                    if (userExists) {
                        Swal.fire({
                            title: 'Erro!',
                            text: 'O Funcionário Já Existe!',
                            icon: 'error',
                            confirmButtonText: 'Ok',
                        });
                    } else {
                        const query = `
                mutation Mutation($data: DadosFuncionario!) {
                createFuncionario(data: $data) {
                    Cargo
                    Email
                    Nome
                    Salario
                    Status
                    idFuncionario
                    }
                }
                `;

                        const variables = {
                            data: {
                                Email: email.trim(),
                                Nome: nome,
                                Cargo: cargo,
                                Status: parseInt(status),
                                Salario: parseFloat(salario),
                            }
                        };
                        console.log(variables);
                        axios.post('http://localhost:4000', { query, variables })
                            .then((response) => {
                                console.log('cadastrando na API');
                                Swal.fire({
                                    title: 'Sucesso!',
                                    text: 'Cadastro de Funcionário Feito com Sucesso',
                                    icon: 'success',
                                    confirmButtonText: 'Ok'
                                });
                                closePopup('popup3');
                            })

                    }
                } catch (error) {
                    console.error('Error during user registration:', error);
                }
            }
        }
        function cadastrarProd() {
            const nome = document.getElementById('nomePr').value;
            const preco = document.getElementById('preco').value;
            const descricao = document.getElementById('descricao').value;
            const status = document.getElementById('statusPr').value;

            if (nome.trim() === '' || preco.trim() === '' || descricao.trim() === '' || status.trim() === 'Status') {
                Swal.fire({
                    title: 'Erro!',
                    text: 'Preencha Todos os Campos',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                });
            } else if (preco.trim() <= 0) {
                Swal.fire({
                    title: 'Erro!',
                    text: 'Preço Inválido',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                });
            } else {
                const query = `
                mutation Mutation($data: dadosProduto) {
                createProduto(data: $data) {
                    Descricao
                    Preco
                    Status
                    idProduto
                    nomeProduto
                }
                }
                `;

                const variables = {
                    data: {
                        Descricao: descricao,
                        nomeProduto: nome,
                        Preco: parseFloat(preco),
                        Status: parseInt(status),
                    }
                };
                console.log(variables);
                axios.post('http://localhost:4000', { query, variables })
                    .then((response) => {
                        console.log('cadastrando na API');
                        Swal.fire({
                            title: 'Sucesso!',
                            text: 'Cadastro de Produto Feito com Sucesso',
                            icon: 'success',
                            confirmButtonText: 'Ok'
                        });
                        closePopup('popup2');
                    })
            }
        }
    </script>

</body>

</html>